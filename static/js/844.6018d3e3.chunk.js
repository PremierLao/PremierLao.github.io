"use strict";(self.webpackChunkjira=self.webpackChunkjira||[]).push([[844],{7844:function(n,e,r){r.r(e),r.d(e,{default:function(){return Xe}});var t=r(7186),i=r(678),o=r(8489),a=r(2791),d=r(4291),u=r(2759),s=r(8619),c=r(286),l=r(1933),f=function(n){var e=(0,c.i)();return(0,l.useQuery)(["users",n],(function(){return e("users",{data:n})}))},h=r(3738),x=r(953),p=r(184),m=["value","onChange","defaultOptionName","options"],v=function(n){var e=n.value,r=n.onChange,t=n.defaultOptionName,i=n.options,a=(0,h.Z)(n,m);return(0,p.jsxs)(x.Z,(0,o.Z)((0,o.Z)({value:null!==i&&void 0!==i&&i.length?j(e):0,onChange:function(n){return null===r||void 0===r?void 0:r(j(n)||void 0)}},a),{},{children:[t?(0,p.jsx)(x.Z.Option,{value:0,children:t}):null,null===i||void 0===i?void 0:i.map((function(n){return(0,p.jsx)(x.Z.Option,{value:n.id,children:n.name},n.id)}))]}))},j=function(n){return isNaN(Number(n))?0:Number(n)},Z=function(n){var e=f().data;return(0,p.jsx)(v,(0,o.Z)({options:e||[]},n))},g=r(4923),C=function(n){n.users;var e=n.param,r=n.setParam;return(0,g.BX)(d.Z,{css:{marginBottom:"2rem"},layout:"inline",children:[(0,g.tZ)(s.Z,{children:(0,g.tZ)(u.Z,{placeholder:"\u9879\u76ee\u540d",type:"text",value:e.name,onChange:function(n){return r((0,o.Z)((0,o.Z)({},e),{},{name:n.target.value}))}})}),(0,g.tZ)(s.Z,{children:(0,g.tZ)(Z,{defaultOptionName:"\u8d1f\u8d23\u4eba",value:e.personId,onChange:function(n){return r((0,o.Z)((0,o.Z)({},e),{},{personId:n}))}})})]})},L=r(595),b=r(2008),k=r(1099),y=r(5786),I=r(7892),w=r.n(I),M=r(1087),E=r(9367),O=["checked","onCheckedChange"],T=function(n){var e=n.checked,r=n.onCheckedChange,t=(0,h.Z)(n,O);return(0,p.jsx)(E.Z,(0,o.Z)({count:1,value:e?1:0,onChange:function(n){return null===r||void 0===r?void 0:r(!!n)}},t))},P=r(5850),N=r(1303),F=r(7166),z=r(3032),D=function(n){var e=n.fromId,r=n.type,t=n.referenceId,i=n.list,o=(0,N.Z)(i),a=o.findIndex((function(n){return n.id===e}));if(!t)return R((0,N.Z)(o),a,o.length-1);var d=o.findIndex((function(n){return n.id===t}));return("after"===r?R:S)((0,N.Z)(o),a,d)},S=function(n,e,r){var t=n[r],i=n.splice(e,1)[0],o=n.indexOf(t);return n.splice(o,0,i),n},R=function(n,e,r){var t=n[r],i=n.splice(e,1)[0],o=n.indexOf(t);return n.splice(o+1,0,i),n},A=function(n,e){var r=(0,l.useQueryClient)();return{onSuccess:function(){return r.invalidateQueries(n)},onMutate:function(t){return(0,z.Z)((0,F.Z)().mark((function i(){var o;return(0,F.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=r.getQueryData(n),r.setQueryData(n,(function(n){return e(t,n)})),i.abrupt("return",{previousItems:o});case 3:case"end":return i.stop()}}),i)})))()},onError:function(e,t,i){r.setQueryData(n,i.previousItems)}}},Q=function(n){return A(n,(function(n,e){return(null===e||void 0===e?void 0:e.filter((function(e){return e.id!==n.id})))||[]}))},Y=function(n){return A(n,(function(n,e){return(null===e||void 0===e?void 0:e.map((function(e){return e.id===n.id?(0,o.Z)((0,o.Z)({},e),n):e})))||[]}))},X=function(n){return A(n,(function(n,e){return e?[].concat((0,N.Z)(e),[n]):[]}))},W=function(n){var e=(0,c.i)();return(0,l.useQuery)(["projects",(0,P.sW)(n)],(function(){return e("projects",{data:n})}))},B=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){return e("projects/".concat(n.id),{method:"PATCH",data:n})}),Y(n))},V=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){return e("projects",{data:n,method:"POST"})}),X(n))},H=function(n){var e=(0,c.i)();return(0,l.useQuery)(["project",{id:n}],(function(){return e("projects/".concat(n))}),{enabled:Boolean(n)})},K=r(5728),U=function(n){var e=(0,M.lr)(),r=(0,i.Z)(e,1)[0],t=q(),o=(0,a.useState)(n),d=(0,i.Z)(o,1)[0];return[(0,a.useMemo)((function(){return(0,P.P9)(Object.fromEntries(r),d)}),[r,d]),function(n){return t(n)}]},q=function(){var n=(0,M.lr)(),e=(0,i.Z)(n,2),r=e[0],t=e[1];return function(n){var e=(0,P.sW)((0,o.Z)((0,o.Z)({},Object.fromEntries(r)),n));return t(e)}},_=function(){var n=U(["name","personId"]),e=(0,i.Z)(n,2),r=e[0],t=e[1];return[(0,a.useMemo)((function(){return(0,o.Z)((0,o.Z)({},r),{},{personId:Number(r.personId)||void 0})}),[r]),t]},G=function(){var n=_();return["projects",(0,i.Z)(n,1)[0]]},J=function(){var n=U(["projectCreate"]),e=(0,i.Z)(n,2),r=e[0].projectCreate,t=e[1],o=U(["editingProjectId"]),a=(0,i.Z)(o,2),d=a[0].editingProjectId,u=a[1],s=q(),c=H(Number(d)),l=c.data,f=c.isLoading;return{projectModalOpen:"true"===r||Boolean(d),open:function(){return t({projectCreate:!0})},close:function(){return s({projectCreate:"",editingProjectId:""})},startEdit:function(n){return u({editingProjectId:n})},editingProject:l,isLoading:f}},$=["users"],nn=function(n){var e=n.users,r=(0,h.Z)(n,$),t=B(G()).mutate;return(0,p.jsx)(L.Z,(0,o.Z)({rowKey:"id",pagination:!1,columns:[{title:(0,p.jsx)(T,{checked:!0,disabled:!0}),render:function(n,e){return(0,p.jsx)(T,{checked:e.pin,onCheckedChange:(r=e.id,function(n){return t({id:r,pin:n})})});var r}},{title:"\u540d\u79f0",sorter:function(n,e){return n.name.localeCompare(e.name)},render:function(n,e){return(0,p.jsx)(M.rU,{to:"projects/".concat(String(e.id)),children:e.name})}},{title:"\u90e8\u95e8",dataIndex:"organization"},{title:"\u8d1f\u8d23\u4eba",render:function(n,r){var t;return(0,p.jsx)("span",{children:(null===(t=e.find((function(n){return n.id===r.personId})))||void 0===t?void 0:t.name)||"\u672a\u77e5"})}},{title:"\u521b\u5efa\u65f6\u95f4",render:function(n,e){return(0,p.jsx)("span",{children:e.created?w()(e.created).format("YYYY-MM-DD"):"\u65e0"})}},{render:function(n,e){return(0,p.jsx)(en,{project:e})}}]},r))},en=function(n){var e,r=n.project,t=J().startEdit,i=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){var r=n.id;return e("projects/".concat(r),{method:"DELETE"})}),Q(n))}(G()),o=i.mutate;return(0,p.jsx)(k.Z,{overlay:(0,p.jsxs)(y.Z,{children:[(0,p.jsx)(y.Z.Item,{onClick:(e=r.id,function(){return t(e)}),children:"\u7f16\u8f91"},"edit"),(0,p.jsx)(y.Z.Item,{onClick:function(){return function(n){b.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u8fd9\u4e2a\u9879\u76ee\u5417?",content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664",okText:"\u786e\u5b9a",onOk:function(){o({id:n})}})}(r.id)},children:"\u5220\u9664"},"delete")]}),children:(0,p.jsx)(K.zL,{type:"link",children:"..."})})},rn=["metadata","phases"],tn=[];setInterval((function(){if(tn.length){var n=(0,N.Z)(tn);tn=[],console.log(n)}}),5e3);var on=function(n){var e=n.metadata,r=n.phases,t=(0,h.Z)(n,rn);return(0,p.jsx)(a.Profiler,(0,o.Z)({onRender:function(n,t,i,o,a,d,u){r&&!r.includes(t)||tn.push({id:n,phase:t,actualDuration:i,baseDuration:o,startTime:a,commitTime:d,interactions:u,metadata:e})}},t))},an=function(){(0,P.jr)("\u9879\u76ee\u5217\u8868",!1);var n=J().open,e=_(),r=(0,i.Z)(e,2),t=r[0],o=r[1],a=W((0,P.Nr)(t,200)),d=a.isLoading,u=a.error,s=a.data,c=f().data;return(0,p.jsx)(on,{id:"\u9879\u76ee\u5217\u8868",children:(0,p.jsxs)(K.X_,{children:[(0,p.jsxs)(K.X2,{marginBottom:2,between:!0,children:[(0,p.jsx)("h1",{children:"\u9879\u76ee\u5217\u8868"}),(0,p.jsx)(K.zL,{onClick:n,type:"link",children:"\u521b\u5efa\u9879\u76ee"})]}),(0,p.jsx)(C,{users:c||[],param:t,setParam:o}),(0,p.jsx)(K.Tv,{error:u}),(0,p.jsx)(nn,{loading:d,users:c||[],dataSource:s||[]})]})})};an.whyDidYouRender=!1;var dn,un,sn=r(9042),cn=r(225),ln=["title","titleId"];function fn(){return fn=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n},fn.apply(this,arguments)}function hn(n,e){if(null==n)return{};var r,t,i=function(n,e){if(null==n)return{};var r,t,i={},o=Object.keys(n);for(t=0;t<o.length;t++)r=o[t],e.indexOf(r)>=0||(i[r]=n[r]);return i}(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(t=0;t<o.length;t++)r=o[t],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(n,r)&&(i[r]=n[r])}return i}function xn(n,e){var r=n.title,t=n.titleId,i=hn(n,ln);return a.createElement("svg",fn({viewBox:"0 0 179 32",xmlns:"http://www.w3.org/2000/svg",focusable:"false","aria-hidden":"true",className:"css-sq9aeg-Logo",ref:e,"aria-labelledby":t},i),r?a.createElement("title",{id:t},r):null,dn||(dn=a.createElement("defs",null,a.createElement("linearGradient",{x1:"97.6553341%",y1:"35.6591143%",x2:"37.202032%",y2:"75.4891864%",id:"uid392-1"},a.createElement("stop",{stopColor:"#0052CC",offset:"7%"}),a.createElement("stop",{stopColor:"#2684FF",offset:"100%"})),a.createElement("linearGradient",{x1:"8.43371138%",y1:"60.1495759%",x2:"64.1161517%",y2:"23.5790285%",id:"uid392-2"},a.createElement("stop",{stopColor:"#0052CC",offset:"0%"}),a.createElement("stop",{stopColor:"#2684FF",offset:"100%"})))),un||(un=a.createElement("g",{stroke:"none",strokeWidth:1,fillRule:"nonzero"},a.createElement("path",{d:"M11.3881081,27.9242105 C12.4881804,26.8071817 13.1062496,25.2917664 13.1062496,23.7115789 C13.1062496,22.1313915 12.4881804,20.6159762 11.3881081,19.4989474 L11.3881081,19.4989474 L3.74837838,11.7621053 L0.273513514,15.2926316 C-0.0900771727,15.6625064 -0.0900771727,16.2617042 0.273513514,16.6315789 L11.3881081,27.9242105 L11.3881081,27.9242105 Z",fill:"currentColor",fillRule:"nonzero"}),a.createElement("path",{d:"M22.5027027,15.2926316 L11.3881081,4 L11.3881081,4 L11.3539189,4.03473684 L11.3539189,4.03473684 C9.08852466,6.36456187 9.09963243,10.1156459 11.3787838,12.4315789 L19.0247297,20.1652632 L22.5027027,16.6315789 C22.8662934,16.2617042 22.8662934,15.6625064 22.5027027,15.2926316 Z",fill:"currentColor",fillRule:"nonzero"}),a.createElement("path",{d:"M11.3881081,12.4252632 C9.10895676,10.1093301 9.09784899,6.35824608 11.3632432,4.02842105 L3.43445946,12.0810526 L7.58067568,16.2936842 L11.3881081,12.4252632 Z",fill:"url(#uid392-1)",fillRule:"nonzero"}),a.createElement("path",{d:"M15.1893243,15.6368421 L11.3881081,19.4989474 C12.4881804,20.6159762 13.1062496,22.1313915 13.1062496,23.7115789 C13.1062496,25.2917664 12.4881804,26.8071817 11.3881081,27.9242105 L19.3355405,19.8494737 L15.1893243,15.6368421 Z",fill:"url(#uid392-2)",fillRule:"nonzero"}),a.createElement("path",{d:"M36.07,18.956 C36.07,20.646 35.394,21.842 33.418,21.842 C32.56,21.842 31.702,21.686 31,21.4 L31,23.662 C31.65,23.896 32.586,24.104 33.808,24.104 C37.032,24.104 38.41,21.946 38.41,18.8 L38.41,6.918 L36.07,6.918 L36.07,18.956 Z M41.894,7.568 C41.894,8.556 42.544,9.128 43.454,9.128 C44.364,9.128 45.014,8.556 45.014,7.568 C45.014,6.58 44.364,6.008 43.454,6.008 C42.544,6.008 41.894,6.58 41.894,7.568 Z M42.31,24 L44.546,24 L44.546,11 L42.31,11 L42.31,24 Z M47.926,24 L50.11,24 L50.11,16.33 C50.11,13.574 51.852,12.716 54.712,13.002 L54.712,10.818 C52.164,10.662 50.864,11.754 50.11,13.288 L50.11,11 L47.926,11 L47.926,24 Z M65.45,24 L65.45,21.66 C64.618,23.376 63.058,24.26 61.056,24.26 C57.598,24.26 55.856,21.322 55.856,17.5 C55.856,13.834 57.676,10.74 61.316,10.74 C63.214,10.74 64.67,11.598 65.45,13.288 L65.45,11 L67.686,11 L67.686,24 L65.45,24 Z M58.092,17.5 C58.092,20.62 59.34,22.18 61.654,22.18 C63.656,22.18 65.45,20.906 65.45,18.02 L65.45,16.98 C65.45,14.094 63.812,12.82 61.914,12.82 C59.392,12.82 58.092,14.484 58.092,17.5 Z M86.926,19.294 C86.926,16.226 84.898,15.056 81.284,14.146 C78.268,13.392 77.176,12.69 77.176,11.286 C77.176,9.726 78.502,8.946 80.738,8.946 C82.506,8.946 84.352,9.258 86.068,10.246 L86.068,7.906 C84.898,7.256 83.312,6.658 80.842,6.658 C76.864,6.658 74.836,8.634 74.836,11.286 C74.836,14.094 76.552,15.42 80.4,16.356 C83.65,17.136 84.586,17.942 84.586,19.45 C84.586,20.958 83.624,21.972 81.05,21.972 C78.788,21.972 76.344,21.374 74.758,20.542 L74.758,22.934 C76.084,23.61 77.618,24.26 80.92,24.26 C85.158,24.26 86.926,22.258 86.926,19.294 Z M95.09,24.26 C91.19,24.26 88.902,21.374 88.902,17.474 C88.902,13.574 91.19,10.74 95.09,10.74 C98.964,10.74 101.226,13.574 101.226,17.474 C101.226,21.374 98.964,24.26 95.09,24.26 Z M95.09,12.82 C92.308,12.82 91.086,15.004 91.086,17.474 C91.086,19.944 92.308,22.18 95.09,22.18 C97.846,22.18 99.042,19.944 99.042,17.474 C99.042,15.004 97.846,12.82 95.09,12.82 Z M106.92,9.622 C106.92,8.452 107.596,7.646 108.974,7.646 C109.494,7.646 109.988,7.698 110.378,7.776 L110.378,5.722 C109.988,5.618 109.546,5.514 108.87,5.514 C106.088,5.514 104.736,7.152 104.736,9.57 L104.736,11 L102.63,11 L102.63,13.08 L104.736,13.08 L104.736,24 L106.92,24 L106.92,13.08 L110.274,13.08 L110.274,11 L106.92,11 L106.92,9.622 Z M115.786,19.892 L115.786,13.08 L119.244,13.08 L119.244,11 L115.786,11 L115.786,8.244 L113.602,8.244 L113.602,11 L111.496,11 L111.496,13.08 L113.602,13.08 L113.602,19.944 C113.602,22.362 114.954,24 117.736,24 C118.412,24 118.854,23.896 119.244,23.792 L119.244,21.634 C118.854,21.712 118.36,21.816 117.84,21.816 C116.462,21.816 115.786,21.036 115.786,19.892 Z M125.432,24 L128.292,24 L130.528,17.708 L131.724,13.704 L132.92,17.708 L135.156,24 L138.016,24 L142.8,11 L140.33,11 L136.586,22.024 L132.79,11 L130.658,11 L126.862,22.024 L123.118,11 L120.648,11 L125.432,24 Z M153.538,24 L153.538,21.66 C152.706,23.376 151.146,24.26 149.144,24.26 C145.686,24.26 143.944,21.322 143.944,17.5 C143.944,13.834 145.764,10.74 149.404,10.74 C151.302,10.74 152.758,11.598 153.538,13.288 L153.538,11 L155.774,11 L155.774,24 L153.538,24 Z M146.18,17.5 C146.18,20.62 147.428,22.18 149.742,22.18 C151.744,22.18 153.538,20.906 153.538,18.02 L153.538,16.98 C153.538,14.094 151.9,12.82 150.002,12.82 C147.48,12.82 146.18,14.484 146.18,17.5 Z M159.154,24 L161.338,24 L161.338,16.33 C161.338,13.574 163.08,12.716 165.94,13.002 L165.94,10.818 C163.392,10.662 162.092,11.754 161.338,13.288 L161.338,11 L159.154,11 L159.154,24 Z M178.108,23.48 C177.042,24.052 175.404,24.26 174.078,24.26 C169.216,24.26 167.084,21.452 167.084,17.474 C167.084,13.548 169.268,10.74 173.22,10.74 C177.224,10.74 178.836,13.522 178.836,17.474 L178.836,18.488 L169.346,18.488 C169.658,20.698 171.088,22.128 174.156,22.128 C175.664,22.128 176.938,21.842 178.108,21.426 L178.108,23.48 Z M173.116,12.768 C170.75,12.768 169.554,14.302 169.32,16.564 L176.574,16.564 C176.444,14.146 175.352,12.768 173.116,12.768 Z",fill:"inherit",fillRule:"evenodd"}))))}var pn=a.forwardRef(xn),mn=(r.p,r(7309)),vn=r(7689),jn=function(n){var e=(0,c.i)(),r=(0,o.Z)((0,o.Z)({},n),{},{name:(0,P.Nr)(null===n||void 0===n?void 0:n.name,200)});return(0,l.useQuery)(["tasks",r],(function(){return e("tasks",{data:r})}))},Zn=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){return e("tasks/reorder",{data:n,method:"POST"})}),function(n){return A(n,(function(n,e){return D((0,o.Z)({list:e},n)).map((function(e){return e.id===n.fromId?(0,o.Z)((0,o.Z)({},e),{},{kanbanId:n.toKanbanId}):e}))}))}(n))},gn=function(){var n,e=null===(n=(0,vn.TH)().pathname.match(/projects\/(\d+)/))||void 0===n?void 0:n[1];return Number(e)},Cn=function(){return H(gn())},Ln=function(){return{projectId:gn()}},bn=function(){return["kanbans",Ln()]},kn=function(){var n=U(["name","typeId","processorId","tagId"]),e=(0,i.Z)(n,1)[0],r=gn();return(0,a.useMemo)((function(){return{projectId:r,typeId:Number(e.typeId)||void 0,processorId:Number(e.processorId)||void 0,tagId:Number(e.tagId)||void 0,name:e.name}}),[r,e])},yn=function(){return["tasks",kn()]},In=function(){var n=U(["editingTaskId"]),e=(0,i.Z)(n,2),r=e[0].editingTaskId,t=e[1],o=function(n){var e=(0,c.i)();return(0,l.useQuery)(["task",{id:n}],(function(){return e("tasks/".concat(n))}),{enabled:Boolean(n)})}(Number(r)),d=o.data,u=o.isLoading;return{editingTaskId:r,editingTask:d,startEdit:(0,a.useCallback)((function(n){t({editingTaskId:n})}),[t]),close:(0,a.useCallback)((function(){t({editingTaskId:""})}),[t]),isLoading:u}},wn=function(){var n=(0,c.i)();return(0,l.useQuery)(["taskTypes"],(function(){return n("taskTypes")}))};var Mn=r.p+"static/media/task.8f6928c35dfd3f16bc59379ed373746b.svg";var En,On,Tn,Pn,Nn,Fn,zn,Dn,Sn,Rn,An,Qn,Yn,Xn,Wn,Bn=r.p+"static/media/bug.fa8e2ddfdddf6452b4dbf23800885bd2.svg",Vn=r(3813),Hn=function(n){var e=n.kanbanId,r=(0,a.useState)(""),t=(0,i.Z)(r,2),o=t[0],d=t[1],s=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){return e("tasks",{data:n,method:"POST"})}),X(n))}(yn()).mutateAsync,f=gn(),h=(0,a.useState)(!1),x=(0,i.Z)(h,2),m=x[0],v=x[1],j=function(){var n=(0,z.Z)((0,F.Z)().mark((function n(){return(0,F.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s({projectId:f,name:o,kanbanId:e});case 2:v(!1),d("");case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),Z=function(){return v((function(n){return!n}))};return(0,a.useEffect)((function(){m||d("")}),[m]),m?(0,p.jsx)(Vn.Z,{children:(0,p.jsx)(u.Z,{onBlur:Z,placeholder:"\u9700\u8981\u505a\u4e9b\u4ec0\u4e48",autoFocus:!0,onPressEnter:j,value:o,onChange:function(n){return d(n.target.value)}})}):(0,p.jsx)("div",{onClick:Z,children:"+\u521b\u5efa\u4e8b\u52a1"})},Kn=function(n){var e=n.name,r=n.keyword;if(!r)return(0,p.jsx)(p.Fragment,{children:e});var t=e.split(r);return(0,p.jsx)(p.Fragment,{children:t.map((function(n,e){return(0,p.jsxs)("span",{children:[n,e===t.length-1?null:(0,p.jsx)("span",{style:{color:"#257AFD"},children:r})]},e)}))})},Un=function(n){var e=(0,c.i)();return(0,l.useQuery)(["kanbans",n],(function(){return e("kanbans",{data:n})}))},qn=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){return e("kanbans/reorder",{data:n,method:"POST"})}),function(n){return A(n,(function(n,e){return D((0,o.Z)({list:e},n))}))}(n))},_n=r(8890),Gn=["children"],Jn=["children"],$n=["children"],ne=function(n){var e=n.children,r=(0,h.Z)(n,Gn);return(0,p.jsx)(_n.bK,(0,o.Z)((0,o.Z)({},r),{},{children:function(n){return a.isValidElement(e)?a.cloneElement(e,(0,o.Z)((0,o.Z)({},n.droppableProps),{},{ref:n.innerRef,provided:n})):(0,p.jsx)("div",{})}}))},ee=a.forwardRef((function(n,e){var r,t=n.children,i=(0,h.Z)(n,Jn);return(0,p.jsxs)("div",(0,o.Z)((0,o.Z)({ref:e},i),{},{children:[t,null===(r=i.provided)||void 0===r?void 0:r.placeholder]}))})),re=function(n){var e=n.children,r=(0,h.Z)(n,$n);return(0,p.jsx)(_n._l,(0,o.Z)((0,o.Z)({},r),{},{children:function(n){return a.isValidElement(e)?a.cloneElement(e,(0,o.Z)((0,o.Z)((0,o.Z)({},n.draggableProps),n.dragHandleProps),{},{ref:n.innerRef})):(0,p.jsx)("div",{})}}))},te=["kanban"],ie=function(n){var e,r=n.id,t=wn().data,i=null===t||void 0===t||null===(e=t.find((function(n){return n.id===r})))||void 0===e?void 0:e.name;return i?(0,p.jsx)("img",{alt:"task-icon",src:"task"===i?Mn:Bn}):null},oe=function(n){var e=n.task,r=In().startEdit,t=kn().name;return(0,p.jsxs)(Vn.Z,{onClick:function(){return r(e.id)},style:{marginBottom:"0.5rem",cursor:"pointer"},children:[(0,p.jsx)("p",{children:(0,p.jsx)(Kn,{keyword:t,name:e.name})}),(0,p.jsx)(ie,{id:e.typeId})]},e.id)},ae=a.forwardRef((function(n,e){var r=n.kanban,t=(0,h.Z)(n,te),i=jn(kn()).data,a=null===i||void 0===i?void 0:i.filter((function(n){return n.kanbanId===r.id}));return(0,p.jsxs)(ue,(0,o.Z)((0,o.Z)({},t),{},{ref:e,children:[(0,p.jsxs)(K.X2,{between:!0,children:[(0,p.jsx)("h3",{children:r.name}),(0,p.jsx)(de,{kanban:r},r.id)]}),(0,p.jsxs)(se,{children:[(0,p.jsx)(ne,{type:"ROW",direction:"vertical",droppableId:String(r.id),children:(0,p.jsx)(ee,{style:{minHeight:"1rem"},children:null===a||void 0===a?void 0:a.map((function(n,e){return(0,p.jsx)(re,{index:e,draggableId:"task"+n.id,children:(0,p.jsx)("div",{children:(0,p.jsx)(oe,{task:n},n.id)})},n.id)}))})}),(0,p.jsx)(Hn,{kanbanId:r.id})]})]}))})),de=function(n){var e=n.kanban,r=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){var r=n.id;return e("kanbans/".concat(r),{method:"DELETE"})}),Q(n))}(bn()).mutateAsync,t=(0,p.jsx)(y.Z,{children:(0,p.jsx)(y.Z.Item,{children:(0,p.jsx)(mn.ZP,{type:"link",onClick:function(){b.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u770b\u677f\u5417",onOk:function(){return r({id:e.id})}})},children:"\u5220\u9664"})})});return(0,p.jsx)(k.Z,{overlay:t,children:(0,p.jsx)(mn.ZP,{type:"link",children:"..."})})},ue=cn.Z.div(En||(En=(0,t.Z)(["\n  min-width: 27rem;\n  border-radius: 6px;\n  background-color: rgb(244, 245, 247);\n  display: flex;\n  flex-direction: column;\n  padding: 0.7rem 0.7rem 1rem;\n  margin-right: 1.5rem;\n"]))),se=cn.Z.div(On||(On=(0,t.Z)(["\n  overflow: scroll;\n  flex: 1;\n\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"]))),ce=function(n){var e=wn().data;return(0,p.jsx)(v,(0,o.Z)({options:e||[]},n))},le=function(){var n=kn(),e=q();return(0,p.jsxs)(K.X2,{marginBottom:4,gap:!0,children:[(0,p.jsx)(u.Z,{style:{width:"20rem"},placeholder:"\u4efb\u52a1\u540d",value:n.name,onChange:function(n){return e({name:n.target.value})}}),(0,p.jsx)(Z,{defaultOptionName:"\u7ecf\u529e\u4eba",value:n.processorId,onChange:function(n){return e({processorId:n})}}),(0,p.jsx)(ce,{defaultOptionName:"\u7c7b\u578b",value:n.typeId,onChange:function(n){return e({typeId:n})}}),(0,p.jsx)(mn.ZP,{onClick:function(){e({typeId:void 0,processorId:void 0,tagId:void 0,name:void 0})},children:"\u6e05\u9664\u7b5b\u9009\u5668"})]})},fe=r(43),he=function(){var n=(0,a.useState)(""),e=(0,i.Z)(n,2),r=e[0],t=e[1],o=gn(),d=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){return e("kanbans",{data:n,method:"POST"})}),X(n))}(bn()).mutateAsync,s=function(){var n=(0,z.Z)((0,F.Z)().mark((function n(){return(0,F.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d({name:r,projectId:o});case 2:t("");case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,p.jsx)(ue,{children:(0,p.jsx)(u.Z,{size:"large",placeholder:"\u65b0\u5efa\u770b\u677f\u540d\u79f0",onPressEnter:s,value:r,onChange:function(n){return t(n.target.value)}})})},xe=r(4086),pe=function(n){var e=(0,c.i)();return(0,l.useQuery)(["epics",n],(function(){return e("epics",{data:n})}))},me=function(n){var e=pe().data;return(0,p.jsx)(v,(0,o.Z)({options:e||[]},n))},ve={labelCol:{span:6},wrapperCol:{span:16}},je=function(){var n=(0,xe.Z)(),e=(0,i.Z)(n,1)[0],r=In(),t=r.editingTaskId,s=r.editingTask,f=r.close,h=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){return e("tasks/".concat(n.id),{method:"PATCH",data:n})}),Y(n))}(yn()),x=h.mutateAsync,m=h.isLoading,v=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){var r=n.id;return e("tasks/".concat(r),{method:"DELETE"})}),Q(n))}(yn()).mutate,j=function(){var n=(0,z.Z)((0,F.Z)().mark((function n(){return(0,F.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x((0,o.Z)((0,o.Z)({},s),e.getFieldsValue()));case 2:f();case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,a.useEffect)((function(){e.setFieldsValue(s)}),[e,s]),(0,p.jsxs)(b.Z,{forceRender:!0,onCancel:function(){f(),e.resetFields()},onOk:j,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",confirmLoading:m,title:"\u7f16\u8f91\u4efb\u52a1",visible:!!t,children:[(0,p.jsxs)(d.Z,(0,o.Z)((0,o.Z)({},ve),{},{initialValues:s,form:e,children:[(0,p.jsx)(d.Z.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}],children:(0,p.jsx)(u.Z,{})}),(0,p.jsx)(d.Z.Item,{label:"\u4efb\u52a1\u7ec4",name:"epicId",children:(0,p.jsx)(me,{defaultOptionName:"\u4efb\u52a1\u7ec4"})}),(0,p.jsx)(d.Z.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId",children:(0,p.jsx)(Z,{defaultOptionName:"\u7ecf\u529e\u4eba"})}),(0,p.jsx)(d.Z.Item,{label:"\u7c7b\u578b",name:"typeId",children:(0,p.jsx)(ce,{})})]})),(0,p.jsx)("div",{style:{textAlign:"right"},children:(0,p.jsx)(mn.ZP,{onClick:function(){f(),b.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u4efb\u52a1\u5417",onOk:function(){return v({id:Number(t)})}})},style:{fontSize:"14px"},size:"small",children:"\u5220\u9664"})})]})},Ze=function(){(0,P.jr)("\u770b\u677f\u5217\u8868");var n=Cn().data,e=Un(Ln()),r=e.data,t=e.isLoading,i=jn(kn()).isLoading||t,o=ge();return(0,p.jsx)(on,{id:"\u770b\u677f\u9875\u9762",children:(0,p.jsx)(_n.Z5,{onDragEnd:o,children:(0,p.jsxs)(K.X_,{children:[(0,p.jsxs)("h1",{children:[null===n||void 0===n?void 0:n.name,"\u770b\u677f"]}),(0,p.jsx)(le,{}),i?(0,p.jsx)(fe.Z,{size:"large"}):(0,p.jsxs)(Ce,{children:[(0,p.jsx)(ne,{type:"COLUMN",direction:"horizontal",droppableId:"kanban",children:(0,p.jsx)(ee,{style:{display:"flex"},children:null===r||void 0===r?void 0:r.map((function(n,e){return(0,p.jsx)(re,{draggableId:"kanban"+n.id,index:e,children:(0,p.jsx)(ae,{kanban:n},n.id)},n.id)}))})}),(0,p.jsx)(he,{})]}),(0,p.jsx)(je,{})]})})})},ge=function(){var n=Un(Ln()).data,e=qn(bn()).mutate,r=Zn(yn()).mutate,t=jn(kn()).data,i=void 0===t?[]:t;return(0,a.useCallback)((function(t){var o=t.source,a=t.destination,d=t.type;if(a){if("COLUMN"===d){var u=null===n||void 0===n?void 0:n[o.index].id,s=null===n||void 0===n?void 0:n[a.index].id;if(!u||!s||u===s)return;var c=a.index>o.index?"after":"before";e({fromId:u,referenceId:s,type:c})}if("ROW"===d){var l=+o.droppableId,f=+a.droppableId,h=i.filter((function(n){return n.kanbanId===l}))[o.index],x=i.filter((function(n){return n.kanbanId===f}))[a.index];if((null===h||void 0===h?void 0:h.id)===(null===x||void 0===x?void 0:x.id))return;r({fromId:null===h||void 0===h?void 0:h.id,referenceId:null===x||void 0===x?void 0:x.id,fromKanbanId:l,toKanbanId:f,type:l===f&&a.index>o.index?"after":"before"})}}}),[n,e,i,r])},Ce=(0,cn.Z)("div")(Tn||(Tn=(0,t.Z)(["\n  display: flex;\n  overflow-x: scroll;\n  flex: 1;\n"]))),Le=r(8715),be=function(){return{projectId:gn()}},ke=function(){return["epics",be()]},ye=r(7828),Ie=function(n){var e=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){return e("epics",{data:n,method:"POST"})}),X(n))}(ke()),r=e.mutate,t=e.isLoading,s=e.error,f=d.Z.useForm(),h=(0,i.Z)(f,1)[0],x=gn(),m=function(){var e=(0,z.Z)((0,F.Z)().mark((function e(t){return(0,F.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r((0,o.Z)((0,o.Z)({},t),{},{projectId:x}));case 2:n.onClose();case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){h.resetFields()}),[h,n.visible]),(0,p.jsx)(ye.Z,{visible:n.visible,onClose:n.onClose,forceRender:!0,destroyOnClose:!0,width:"100%",children:(0,p.jsx)(we,{children:t?(0,p.jsx)(fe.Z,{size:"large"}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h1",{children:"\u521b\u5efa\u4efb\u52a1\u7ec4"}),(0,p.jsx)(K.Tv,{error:s}),(0,p.jsxs)(d.Z,{form:h,layout:"vertical",style:{width:"40rem"},onFinish:m,children:[(0,p.jsx)(d.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d"}],children:(0,p.jsx)(u.Z,{placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d\u79f0"})}),(0,p.jsx)(d.Z.Item,{style:{textAlign:"right"},children:(0,p.jsx)(mn.ZP,{loading:t,type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})]})})})},we=cn.Z.div(Pn||(Pn=(0,t.Z)(["\n  height: 80vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]))),Me=function(){var n=Cn().data,e=pe(be()).data,r=jn({projectId:null===n||void 0===n?void 0:n.id}).data,t=function(n){var e=(0,c.i)();return(0,l.useMutation)((function(n){var r=n.id;return e("epics/".concat(r),{method:"DELETE"})}),Q(n))}(ke()).mutate,o=(0,a.useState)(!1),d=(0,i.Z)(o,2),u=d[0],s=d[1];return(0,p.jsxs)(K.X_,{children:[(0,p.jsxs)(K.X2,{between:!0,children:[(0,p.jsxs)("h1",{children:[null===n||void 0===n?void 0:n.name,"\u4efb\u52a1\u7ec4"]}),(0,p.jsx)(mn.ZP,{onClick:function(){return s(!0)},type:"link",children:"\u521b\u5efa\u4efb\u52a1\u7ec4"})]}),(0,p.jsx)(Le.Z,{style:{overflow:"scroll"},dataSource:e,itemLayout:"vertical",renderItem:function(e){return(0,p.jsxs)(Le.Z.Item,{children:[(0,p.jsx)(Le.Z.Item.Meta,{title:(0,p.jsxs)(K.X2,{between:!0,children:[(0,p.jsx)("span",{children:e.name}),(0,p.jsx)(mn.ZP,{onClick:function(){return function(n){b.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u9879\u76ee\u7ec4\uff1a".concat(n.name),content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664",okText:"\u786e\u5b9a",onOk:function(){t({id:n.id})}})}(e)},type:"link",children:"\u5220\u9664"})]}),description:(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{children:["\u5f00\u59cb\u65f6\u95f4\uff1a",w()(e.start).format("YYYY-MM-DD")]}),(0,p.jsxs)("div",{children:["\u7ed3\u675f\u65f6\u95f4\uff1a",w()(e.end).format("YYYY-MM-DD")]})]})}),(0,p.jsx)("div",{children:null===r||void 0===r?void 0:r.filter((function(n){return n.epicId===e.id})).map((function(e){return(0,p.jsx)("div",{children:(0,p.jsx)(M.rU,{to:"/projects/".concat(null===n||void 0===n?void 0:n.id,"/kanban?editingTaskId=").concat(e.id),children:e.name},e.id)})}))})]})}}),(0,p.jsx)(Ie,{onClose:function(){return s(!1)},visible:u})]})},Ee=function(){var n=function(){var n=(0,vn.TH)().pathname.split("/");return n[n.length-1]}();return(0,p.jsxs)(Pe,{children:[(0,p.jsx)(Oe,{children:(0,p.jsxs)(y.Z,{mode:"inline",selectedKeys:[n],children:[(0,p.jsx)(y.Z.Item,{children:(0,p.jsx)(M.rU,{to:"kanban",children:"\u770b\u677f"})},"kanban"),(0,p.jsx)(y.Z.Item,{children:(0,p.jsx)(M.rU,{to:"epic",children:"\u4efb\u52a1\u7ec4"})},"epic")]})}),(0,p.jsx)(Te,{children:(0,p.jsxs)(vn.Z5,{children:[(0,p.jsx)(vn.AW,{path:"kanban",element:(0,p.jsx)(Ze,{})}),(0,p.jsx)(vn.AW,{path:"epic",element:(0,p.jsx)(Me,{})}),(0,p.jsx)(vn.AW,{index:!0,element:(0,p.jsx)(Ze,{})})]})})]})},Oe=cn.Z.aside(Nn||(Nn=(0,t.Z)(["\n  background-color: rgb(244, 245, 247);\n  display: flex;\n"]))),Te=cn.Z.div(Fn||(Fn=(0,t.Z)(["\n  box-shadow: -5px 0 5px -5px rgba(0, 0, 0, 0.1);\n  display: flex;\n  overflow: hidden;\n"]))),Pe=cn.Z.div(zn||(zn=(0,t.Z)(["\n  display: grid;\n  grid-template-columns: 16rem 1fr;\n  width: 100%;\n"]))),Ne=r(5796),Fe=r(7128),ze=r(3403),De=function(){var n=J().open,e=W(),r=e.data,t=e.isLoading,i=null===r||void 0===r?void 0:r.filter((function(n){return n.pin})),o=(0,p.jsxs)(Se,{children:[(0,p.jsx)(Ne.Z.Text,{type:"secondary",children:"\u6536\u85cf\u9879\u76ee"}),(0,p.jsx)(Le.Z,{children:null===i||void 0===i?void 0:i.map((function(n){return(0,p.jsx)(Le.Z.Item,{children:(0,p.jsx)(Le.Z.Item.Meta,{title:n.name})},n.id)}))}),(0,p.jsx)(Fe.Z,{}),(0,p.jsx)(K.zL,{onClick:n,type:"link",children:"\u521b\u5efa\u9879\u76ee"})]});return(0,p.jsx)(ze.Z,{onVisibleChange:function(){return t},placement:"bottom",content:o,children:(0,p.jsx)("span",{children:"\u9879\u76ee"})})},Se=cn.Z.div(Dn||(Dn=(0,t.Z)(["\n  min-width: 30rem;\n"]))),Re=function(){var n=J(),e=n.projectModalOpen,r=n.close,t=n.editingProject,s=n.isLoading,c=(t?B:V)(G()),l=c.mutateAsync,f=c.error,h=c.isLoading,x=d.Z.useForm(),m=(0,i.Z)(x,1)[0],v=t?"\u7f16\u8f91\u9879\u76ee":"\u521b\u5efa\u9879\u76ee";return(0,a.useEffect)((function(){m.setFieldsValue(t)}),[t,m]),(0,p.jsx)(ye.Z,{forceRender:!0,onClose:function(){m.resetFields(),r()},visible:e,width:"100%",children:(0,p.jsx)(Ae,{children:s?(0,p.jsx)(fe.Z,{size:"large"}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h1",{children:v}),(0,p.jsx)(K.Tv,{error:f}),(0,p.jsxs)(d.Z,{form:m,layout:"vertical",style:{width:"40rem"},onFinish:function(n){l((0,o.Z)((0,o.Z)({},t),n)).then((function(){m.resetFields(),r()}))},children:[(0,p.jsx)(d.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d"}],children:(0,p.jsx)(u.Z,{placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0"})}),(0,p.jsx)(d.Z.Item,{label:"\u90e8\u95e8",name:"organization",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d"}],children:(0,p.jsx)(u.Z,{placeholder:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d"})}),(0,p.jsx)(d.Z.Item,{label:"\u8d1f\u8d23\u4eba",name:"personId",children:(0,p.jsx)(Z,{defaultOptionName:"\u8d1f\u8d23\u4eba"})}),(0,p.jsx)(d.Z.Item,{style:{textAlign:"right"},children:(0,p.jsx)(mn.ZP,{loading:h,type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})]})})})},Ae=cn.Z.div(Sn||(Sn=(0,t.Z)(["\n  height: 80vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]))),Qe=function(){var n=f(),e=n.data,r=n.refetch,t=(0,p.jsxs)(Ye,{children:[(0,p.jsx)(Ne.Z.Text,{type:"secondary",children:"\u7ec4\u5458\u5217\u8868"}),(0,p.jsx)(Le.Z,{children:null===e||void 0===e?void 0:e.map((function(n){return(0,p.jsx)(Le.Z.Item,{children:(0,p.jsx)(Le.Z.Item.Meta,{title:n.name})},n.id)}))}),(0,p.jsx)(Fe.Z,{})]});return(0,p.jsx)(ze.Z,{onVisibleChange:function(){return r()},placement:"bottom",content:t,children:(0,p.jsx)("span",{children:"\u7ec4\u5458"})})},Ye=cn.Z.div(Rn||(Rn=(0,t.Z)(["\n  min-width: 30rem;\n"])));function Xe(){return(0,p.jsx)(Ve,{children:(0,p.jsxs)(M.VK,{children:[(0,p.jsx)(We,{}),(0,p.jsx)(qe,{children:(0,p.jsxs)(vn.Z5,{children:[(0,p.jsx)(vn.AW,{path:"projects",element:(0,p.jsx)(an,{})}),(0,p.jsx)(vn.AW,{path:"projects/:projectId/*",element:(0,p.jsx)(Ee,{})}),(0,p.jsx)(vn.AW,{index:!0,element:(0,p.jsx)(an,{})})]})}),(0,p.jsx)(Re,{})]})})}var We=function(){return(0,p.jsxs)(He,{between:!0,children:[(0,p.jsxs)(Ue,{gap:!0,children:[(0,p.jsx)(K.zL,{type:"link",onClick:P.Xj,children:(0,p.jsx)(pn,{width:"18rem",color:"rgb(38,132,255)"})}),(0,p.jsx)(De,{}),(0,p.jsx)(Qe,{})]}),(0,p.jsx)(Ke,{children:(0,p.jsx)(Be,{})})]})},Be=function(){var n=(0,sn.a)(),e=n.logout,r=n.user;return(0,p.jsx)(k.Z,{overlay:(0,p.jsx)(y.Z,{children:(0,p.jsx)(y.Z.Item,{children:(0,p.jsx)(mn.ZP,{onClick:e,type:"link",children:"\u767b\u51fa"})},"logout")}),children:(0,p.jsxs)(mn.ZP,{type:"link",onClick:function(n){n.preventDefault()},children:["Hi,",null===r||void 0===r?void 0:r.name]})})},Ve=cn.Z.div(An||(An=(0,t.Z)(['\ndisplay: grid;\ngrid-template-areas: "header" "main";\ngrid-template-rows: 6rem calc(100vh - 6rem);\nheight: 100vh;']))),He=(0,cn.Z)(K.X2)(Qn||(Qn=(0,t.Z)(["\npadding: 3.2rem;\nbox-shadow: 0 0 5px 0 rgba(0,0,0,0.1);\nz-index: 1"]))),Ke=cn.Z.div(Yn||(Yn=(0,t.Z)([""]))),Ue=(0,cn.Z)(K.X2)(Xn||(Xn=(0,t.Z)([""]))),qe=cn.Z.main(Wn||(Wn=(0,t.Z)(["\ndisplay: flex;\n  overflow: hidden;\ngrid-area: main;"])))}}]);
//# sourceMappingURL=844.6018d3e3.chunk.js.map